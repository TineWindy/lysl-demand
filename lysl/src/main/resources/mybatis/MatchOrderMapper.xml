<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.whu.lysl.dao.MatchOrderDAO">

    <sql id="MatchOrderCols">
        gmt_created, donor_id, donee_id, material_id,material_quantity,status,donation_order_id,demand_order_id,tracking_number
     </sql>

    <sql id="MatchOrderTable">
        lysl_match_order
    </sql>



    <insert id="saveMatchOrder" parameterType="com.whu.lysl.entity.dbobj.MatchOrderDo">
        insert into lysl_match_order(gmt_created,gmt_modified,donor_id,donee_id,material_id,material_quantity,status,
        matching_method,donation_order_id,demand_order_id,tracking_number)
        values(#{gmtCreated},#{gmtModified},#{donorId},#{doneeId},#{materialId},#{materialQuantity},#{status},#{matchingMethod},#{donationOrderId},
        #{demandOrderId},#{trackingNumber})
    </insert>

    <select id="selectDonationOrderIdByDonorId" resultType="int" parameterType="int">
        SELECT donation_order_id
        FROM
        <include refid="MatchOrderTable" />
        WHERE donor_id = #{donorId} group by donation_order_id
    </select>

    <select id="selectByDonorIdAndDonationOrderId" resultType="com.whu.lysl.entity.dbobj.MatchOrderDo" parameterType="int">
        SELECT <include refid="MatchOrderCols"></include>
        FROM
        <include refid="MatchOrderTable" />
        WHERE donor_id = #{donorId} and donation_order_id = #{donationOrderId}
    </select>

    <select id="selectDemandOrderIdByDoneeId" resultType="int" parameterType="int">
        SELECT demand_order_id
        FROM
        <include refid="MatchOrderTable" />
        WHERE donee_id = #{doneeId} group by demand_order_id
    </select>

    <select id="selectByDoneeIdAndDonationOrderId" resultType="com.whu.lysl.entity.dbobj.MatchOrderDo" parameterType="int">
        SELECT <include refid="MatchOrderCols"></include>
        FROM
        <include refid="MatchOrderTable" />
        WHERE donee_id = #{doneeId} and demand_order_id = #{demandOrderId}
    </select>


    <update id="updateStatus">
        UPDATE <include refid="MatchOrderTable"></include> SET status = #{status} where id = #{matchOrderId}
    </update>

    <update id="updateTrackingNumber">
        UPDATE <include refid="MatchOrderTable"></include> SET tracking_number = #{trackingNumber} where id = #{matchOrderId}
    </update>

    <select id="getMatchOrderGroupList" resultType="com.whu.lysl.entity.condition.MatchOrderCondition" parameterType="com.whu.lysl.entity.condition.MatchOrderCondition">
        select <include refid="MatchOrderCols"></include>
        FROM
        <include refid="MatchOrderTable"></include>
        <where>
        <if test="donorId != 0">
            AND donor_id = #{donorId}
        </if>
        <if test="doneeId != 0">
            AND donee_id = #{doneeId}
        </if>
        <if test="status != null">
            AND status = #{status}
        </if>
         <if test="matchingMethod != null">
             AND matching_method = #{matchingMethod}
         </if>
        </where> group by donor_id,donee_id,donation_order_id,demand_order_id
    </select>

    <select id="selectByDoneeIdAndDonationOrderIdAndDonorIdAndDoneeId" resultType="com.whu.lysl.entity.dbobj.MatchOrderDo" parameterType="com.whu.lysl.entity.condition.MatchOrderCondition">
        SELECT <include refid="MatchOrderCols"></include>
        FROM
        <include refid="MatchOrderTable" />
        <where>
            <if test="donorId != null">
                AND donor_id = #{donorId}
            </if>
            <if test="doneeId != null">
                AND donee_id = #{doneeId}
            </if>
            <if test="demandOrderId != null">
                AND demand_order_id = #{demandOrderId}
            </if>
            <if test="donationOrderId != null">
                AND donation_order_id = #{donationOrderId}
            </if>
        </where>
    </select>

</mapper>
